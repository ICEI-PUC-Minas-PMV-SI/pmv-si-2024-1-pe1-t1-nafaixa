<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NaFaixa</title>

  <link rel="shortcut icon" href="assets/img/logo.xs.svg" type="image/x-icon" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="CSS/reset.css" />
  <link rel="stylesheet" href="CSS/components/navbar.css" />
  <link rel="stylesheet" href="CSS/components/navbar-mobile.css" />
  <link rel="stylesheet" href="CSS/components/page-style.css" />
  <link rel="stylesheet" href="CSS/components/popup.css">
  <link rel="stylesheet" href="CSS/components/title.css" />
  <link rel="stylesheet" href="CSS/components/event-cards.css" />
  <link rel="stylesheet" href="CSS/components/main-carousel.css" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="CSS/components/categorias-cards.css" />
  <link rel="stylesheet" href="CSS/components/footer.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />


</head>

<body>
  <header>
    <div class="navcenter">
      <div>
        <a href="index.html">
          <img class="logo" src="assets/img/logo2.svg" alt="logo do NaFaixa" /></a>
      </div>
      <form class="nav-search">
        <div class="search">
          <span class="search-icon material-symbols-outlined">search</span>
          <input class="search-input" type="search" placeholder="pesquise por evento" />
        </div>
      </form>
      <nav class="nav-options-web">
        <div onclick="openPopup()" class="localização-web" >
          <img  src="assets/img/localpin.svg" </img>
          <span class="localização-web"  id="escolherLocalização">Localização</span>
            <img src="assets/img/setaprabaixo1.svg"  style="padding-right: 15px"></img>
        </div>

        <a href="criar-evento.html">Criar evento</a>
        <a id="entrar-btn" class="joinBtn" href="login.html">Entrar</a>
      </nav>
    </div>

    <div class="navcenter-mobile">
      <div>
        <a href="index.html">
          <img class="logo" src="assets/img/logo2.svg" alt="logo do NaFaixa" /></a>
      </div>
      <div class="localizacao-mobile">
        <img src="assets/img/localpin.svg" </img>
        <a id="city-mobile">Localização</a>
      </div>
      <nav class="menu-hamburguer">
        <input type="checkbox" class="checkbox-menu">

        <label for="checkbox-menu">
          <span></span>
          <span></span>
          <span></span>
        </label>

        <div id="menu-options">
          <ul>
            <a href="login.html">Entrar</a></br>
            <a href="criar-evento.html">Criar evento</a>
            <a href="#">Sair</a>
          </ul>
        </div>
      </nav>
    </div>
  </header>

  <form class="nav-search-mobile">
    <div class="search">
      <span class="search-icon material-symbols-outlined">search</span>
      <input class="search-input" type="search" placeholder="pesquise por evento" </input>
    </div>
  </form>

  <div class="popup" id="locationPopup">
    <div class="popup-content">
      <h5>Escolha uma localização</h5>
      <input type="text" id="cityInput" placeholder="Digite o nome da cidade que deseja...">
    </div>
  </div>

  <section class="page">
    <div style="width: 100%">
      <div class="wrapper-carousel">
        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="assets/img/carousel1.png" class="d-block w-100" alt="assets/img/carousel2.png" />
            </div>
            <div class="carousel-item">
              <img src="assets/img/carousel2.png" class="d-block w-100" alt="assets/img/carousel2.png" />
            </div>
            <div class="carousel-item">
              <img src="assets/img/carousel3.png" class="d-block w-100" alt="assets/img/carousel2.png" />
            </div>
            <div class="carousel-item">
              <img src="assets/img/carousel4.png" class="d-block w-100" alt="assets/img/carousel2.png" />
            </div>
            <div class="carousel-item">
              <img src="assets/img/carousel5.png" class="d-block w-100" alt="assets/img/carousel2.png" />
            </div>
          </div>

          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
            data-bs-slide="prev">
            <div class="wrapper-carousel-control-prev-icon">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </div>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
            data-bs-slide="next">
            <div class="wrapper-carousel-control-next-icon">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </div>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>

      <div class="events-nearme">
        <h1>Eventos perto de mim</h1>
        <a class="vertodos-button" href="eventosProximos.html">ver todos</a>
      </div>

      <div id="eventosFiltrados" class="wrapper-cards"></div>

      <div>
        <button class="vertodos-button-mobile" href="">Ver todos</button>
      </div>

      <section class="categorias">
        <div class="categorias-header">
          <h1>Categorias</h1>

          <div id="categorias-button">
            <button id="left-btn" type="button">
              <img src="assets/img/arrow-left.svg" alt="botão da esquerda" />
            </button>
            <button id="right-btn" type="button">
              <img src="assets/img/arrow-right.svg" alt="botão da direita" />
            </button>
          </div>
        </div>

        <div id="wrapper-categorias">
          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Teatro.svg" alt="card teatro" />

            <h3>Teatro</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Cultura(1).svg" alt="card Cultura" />

            <h3>Cultura</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Palestras.svg" alt="card Cursos e workshops" />

            <h3>Palestras</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Esportes(1).svg" alt="card Esportes" />

            <h3>Esportes</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Gastronomia(2).svg" alt="card Gastronomia" />

            <h3>Gastronomia</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Infantil(1).svg" alt="card Infantil" />

            <h3>Infantil</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/musica e shows.svg" alt="card Música e shows" />

            <h3>Música e shows</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Standup.svg" alt="card stand up" />

            <h3>Stand up</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Tecnologia.svg" alt="card Tecnologia" />

            <h3>Tecnologia</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Religioso.svg" alt="card Religioso" />

            <h3>Religioso</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Feira.svg" alt="card Feira" />

            <h3>Feira</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Online.svg" alt="card Online" />

            <h3>Online</h3>
          </article>

          <article class="categories-cards">
            <img class="icon-card" src="assets/img-categorias/Ver todos(1).svg" alt="card outros" />

            <h3>Outros</h3>
          </article>
        </div>
      </section>
    </div>

    <div style="width: 100%">
      <h1>Todos os eventos</h1>

      <div id="todosEventos" class="wrapper-cards"></div>

      <div class="wrapper-mostrarMais">
        <button class="mostrarMais">mostrar mais</button>
      </div>
    </div>
  </section>

  <div id="footer-container"></div>

  <script src="/src/JS/navbar.js"></script>

  <script src="/src/JS/footer.js"></script>

  <script src="/src/JS/carrosselCategorias.js"></script>

  <script src="/src/JS/cardsEvento.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6Mt2GUjTup_ly3tWro_MnX6L9v_l5o1s&libraries=places"></script>

  <script>
    // Função para obter a geolocalização do usuário
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
                (position) => {
                  const latitude = position.coords.latitude;
                  const longitude = position.coords.longitude;

                  const geocoder = new google.maps.Geocoder();
                  const latlng = { lat: latitude, lng: longitude };

                  geocoder.geocode({ location: latlng }, (results, status) => {
                    if (status === "OK") {
                      if (results[0]) {
                        const cityName = results[0].address_components[3].long_name;

                        localStorage.setItem('userLocation', JSON.stringify({
                          latitude: latitude,
                          longitude: longitude,
                          city: cityName
                        }));

                        updateNavbarLocation(cityName);
                      }
                    }
                  });
                },
                (error) => {
                  console.error('Erro ao obter localização:', error);
                }
        );
      } else {
        console.error('Geolocalização não suportada pelo navegador.');
      }
    }

    // Função para abrir o popup/fechar o popup
    const popup = document.getElementById('locationPopup');

      function openPopup() {
        popup.style.display = 'block';

        window.addEventListener('click', closePopupOutside);

        window.addEventListener('keydown', closePopupOnEsc);

      function closePopupOutside(event) {
        if (event.target === popup) {
          popup.style.display = 'none';
          window.removeEventListener('click', closePopupOutside);
          window.removeEventListener('keydown', closePopupOnEsc);
        }
      }

      function closePopupOnEsc(event) {
        if (event.key === 'Escape') {
          popup.style.display = 'none';
          window.removeEventListener('click', closePopupOutside);
          window.removeEventListener('keydown', closePopupOnEsc);
        }
      }

    //Função de autocomplete do google no input do popup
      var input = document.getElementById('cityInput');
      var autocomplete = new google.maps.places.Autocomplete(input, {
        types: ['(cities)'],
        componentRestrictions: { country: 'BR' }
      });

      autocomplete.addListener('place_changed', function() {
        var selectedPlace = autocomplete.getPlace();
        if (!selectedPlace.geometry) {
          return;
        }

        var cityName = selectedPlace.name;

        updateNavbarLocation(cityName);

        localStorage.setItem('userLocation', JSON.stringify({
          cityName: cityName,
          latitude: selectedPlace.geometry.location.lat(),
          longitude: selectedPlace.geometry.location.lng()
        }));
        window.location.href = window.location.href;

        document.getElementById('locationPopup').style.display = 'none';
      });
    }

    // Função para atualizar a localização na navbar
    function updateNavbarLocation(cityName) {
      var locationElement = document.getElementById('escolherLocalização');
      if (locationElement) {
        locationElement.textContent = cityName;
      }
    }

    window.onload = function() {
      var userLocation = localStorage.getItem('userLocation');
      if (userLocation) {
        userLocation = JSON.parse(userLocation);
        if (userLocation.cityName) {
          updateNavbarLocation(userLocation.cityName);
        }
      }
    };

    // Função para atualizar o nome da cidade na navbar
    function updateNavbarLocation(cityName) {
      const navLocationElement = document.getElementById('escolherLocalização');
      if (navLocationElement) {
        navLocationElement.textContent = cityName;
      }
    }

    window.onload = () => {
      const userLocation = JSON.parse(localStorage.getItem('userLocation'));
      if (!userLocation) {
        getLocation();
      } else {
        updateNavbarLocation(userLocation.city);
      }
    };

    // Função para atualizar a localização na navbar
    function updateNavbarLocation(cityName) {
      var locationElement = document.getElementById('escolherLocalização');
      if (locationElement) {
        locationElement.textContent = cityName;
      }
    }

    // Função para carregar e definir a localização ao recarregar a página
    function loadUserLocation() {
      var userLocation = localStorage.getItem('userLocation');
      if (userLocation) {
        userLocation = JSON.parse(userLocation);
        if (userLocation.cityName) {
          updateNavbarLocation(userLocation.cityName);
        }
      }
    }

    window.addEventListener('load', function() {
      loadUserLocation();
    });

  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6Mt2GUjTup_ly3tWro_MnX6L9v_l5o1s&libraries=places&language=pt-BR"></script>
  </script>
</body>

</html>